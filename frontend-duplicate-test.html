<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Duplicate Detection Test</title>
</head>
<body>
    <h1>Frontend Duplicate Detection Test</h1>
    
    <div>
        <h2>Test if duplicate check is being called from frontend</h2>
        <button onclick="testFrontendDuplicateCheck()">Test Frontend API Call</button>
        <div id="result"></div>
        
        <h3>Browser Console Output (check F12):</h3>
        <p>Check the browser console for detailed logs</p>
    </div>

    <script>
        // Simulate the exact same API call as the frontend
        async function testFrontendDuplicateCheck() {
            const reportData = {
                title: "Frontend test report",
                description: "Testing duplicate detection from frontend",
                category: "ROADS_INFRASTRUCTURE",
                latitude: 23.8103,
                longitude: 90.4125,
                targetOrganizationIds: [1],
                notifyVolunteers: false
            };

            console.log("üîç Checking for duplicates with data:", reportData);
            
            try {
                // Exactly mimic the frontend service call
                const response = await fetch('http://localhost:8080/api/reports/check-duplicates', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reportData)
                });
                
                console.log("üìã Response status:", response.status);
                console.log("üìã Response ok:", response.ok);
                
                const data = await response.json();
                console.log("üìã Duplicate check response:", data);

                if (data.hasDuplicates) {
                    console.log("‚ö†Ô∏è DUPLICATES FOUND! Count:", data.duplicateCount);
                    console.log("üìã Duplicate details:", data.duplicates);
                    
                    document.getElementById('result').innerHTML = `
                        <h3 style="color: orange;">‚ö†Ô∏è Duplicates Found!</h3>
                        <p>Found ${data.duplicateCount} duplicates</p>
                        <p>This should show the duplicate warning modal in the real app!</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    console.log("‚úÖ No duplicates found");
                    document.getElementById('result').innerHTML = `
                        <h3 style="color: green;">‚úÖ No Duplicates Found</h3>
                        <p>The app should proceed with submission</p>
                    `;
                }
            } catch (error) {
                console.error("‚ùå Error checking for duplicates:", error);
                document.getElementById('result').innerHTML = `
                    <h3 style="color: red;">‚ùå Error!</h3>
                    <p>${error.message}</p>
                    <p>Check browser console for details</p>
                `;
            }
        }

        // Test CORS and basic connectivity
        async function testCors() {
            try {
                console.log("Testing CORS...");
                const response = await fetch('http://localhost:8080/api/ai/status');
                console.log("CORS test successful:", response.status);
            } catch (error) {
                console.error("CORS test failed:", error);
            }
        }

        // Auto-run tests
        window.onload = function() {
            testCors();
        };
    </script>
</body>
</html>
