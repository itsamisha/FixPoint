<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Enhanced Duplicate Test</title>
</head>
<body>
    <h1>AI-Enhanced Duplicate Detection Test</h1>
    
    <div>
        <h2>Test Intelligent Duplicate Detection</h2>
        <p>This should now use AI to understand that similar issues are duplicates</p>
        
        <button onclick="testSemanticSimilarity()">Test Semantic Similarity</button>
        <pre id="semanticResult"></pre>
    </div>

    <script>
        async function testSemanticSimilarity() {
            const tests = [
                {
                    name: "Pothole vs Road Damage (should be SIMILAR)",
                    data: {
                        title: "Road damage issue",
                        description: "There is significant road damage on Main Street",
                        category: "ROADS_INFRASTRUCTURE",
                        latitude: 23.8103,
                        longitude: 90.4125
                    }
                },
                {
                    name: "Waste issue vs Garbage (should be SIMILAR)", 
                    data: {
                        title: "Garbage collection problem",
                        description: "Waste has not been collected for days",
                        category: "SANITATION_WASTE",
                        latitude: 23.8103,
                        longitude: 90.4125
                    }
                },
                {
                    name: "Street light vs Road issue (should be DIFFERENT)",
                    data: {
                        title: "Lighting problem",
                        description: "Street light is not working at night",
                        category: "STREET_LIGHTING", 
                        latitude: 23.8103,
                        longitude: 90.4125
                    }
                }
            ];

            let results = "AI-Enhanced Semantic Similarity Tests:\n\n";
            
            for (const test of tests) {
                try {
                    console.log(`Testing: ${test.name}`);
                    const response = await fetch('http://localhost:8080/api/reports/check-duplicates', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(test.data)
                    });
                    
                    const data = await response.json();
                    results += `${test.name}:\n`;
                    results += `  🤖 AI Analysis: ${data.hasDuplicates ? 'DUPLICATE DETECTED' : 'NO DUPLICATES'}\n`;
                    results += `  📊 Count: ${data.duplicateCount}\n`;
                    if (data.duplicates && data.duplicates.length > 0) {
                        results += `  🎯 Similarity: ${data.duplicates[0].similarity}%\n`;
                        results += `  📝 Found: "${data.duplicates[0].title}"\n`;
                    }
                    results += '\n';
                } catch (error) {
                    results += `${test.name}: ❌ Error - ${error.message}\n\n`;
                }
            }
            
            document.getElementById('semanticResult').textContent = results;
        }

        // Auto-run test
        window.onload = function() {
            setTimeout(testSemanticSimilarity, 1000);
        };
    </script>
</body>
</html>
